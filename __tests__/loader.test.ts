[{"bun:test": "import { mkdir", "node:fs/promises": "import { join"}, {"../src/loader.js\";\n\ndescribe(\"loadSnippets - Dual Path Support": {"tempDir": "string;\n  let globalSnippetDir: string;\n  let projectSnippetDir: string;\n\n  beforeEach(async () => {\n    // Create temporary directories for testing\n    tempDir = join(process.cwd()", ".test-temp\");\n    globalSnippetDir = join(tempDir, \"global-snippet\");\n    projectSnippetDir = join(tempDir, \"project\", \".opencode\", \"snippet": "await mkdir(globalSnippetDir", "recursive": true}, "recursive": true}, {"recursive": true, "force": true}, {"careful.md": "--", "aliases": "safe\n---\nThink step by step. Double-check your work.`", "Think step by step. Double-check your work.\",\n      );\n      expect(snippets.get(\"safe\")).toBe(\n        \"Think step by step. Double-check your work.": ""}, {"snippet1.md\"),\n        \"Content of snippet 1\",\n      );\n      await writeFile(\n        join(globalSnippetDir, \"snippet2.md\"),\n        \"Content of snippet 2\",\n      );\n\n      const snippets = await loadSnippets();\n\n      expect(snippets.size).toBe(2);\n      expect(snippets.get(\"snippet1\")).toBe(\"Content of snippet 1\");\n      expect(snippets.get(\"snippet2\")).toBe(\"Content of snippet 2": ""}, {"project-specific.md\"),\n        \"This is a project-specific snippet\",\n      );\n\n      // Load with project directory\n      const projectDir = join(tempDir, \"project\");\n      const snippets = await loadSnippets(projectDir);\n\n      expect(snippets.size).toBe(1);\n      expect(snippets.get(\"project-specific\")).toBe(\n        \"This is a project-specific snippet": ""}, {"team-rule.md\"),\n        \"Team rule 1\",\n      );\n      await writeFile(\n        join(projectSnippetDir, \"domain-knowledge.md\"),\n        \"Domain knowledge\",\n      );\n\n      const projectDir = join(tempDir, \"project\");\n      const snippets = await loadSnippets(projectDir);\n\n      expect(snippets.size).toBe(2);\n      expect(snippets.get(\"team-rule\")).toBe(\"Team rule 1\");\n      expect(snippets.get(\"domain-knowledge\")).toBe(\"Domain knowledge": ""}, {"loadSnippets(\"/nonexistent/path": "expect(snippets.size).toBe(0);"}, {"empty-project": "await mkdir(projectDir", "recursive": true}, {"global.md\"),\n        \"Global snippet content\",\n      );\n\n      // Create project snippet\n      await writeFile(\n        join(projectSnippetDir, \"project.md\"),\n        \"Project snippet content\",\n      );\n\n      const projectDir = join(tempDir, \"project\");\n      const snippets = await loadSnippets(projectDir);\n\n      expect(snippets.size).toBe(2);\n      expect(snippets.get(\"global\")).toBe(\"Global snippet content\");\n      expect(snippets.get(\"project\")).toBe(\"Project snippet content": ""}, {"careful.md\"),\n        \"Global careful content\",\n      );\n\n      // Create project snippet with same name\n      await writeFile(\n        join(projectSnippetDir, \"careful.md\"),\n        \"Project-specific careful content\",\n      );\n\n      const projectDir = join(tempDir, \"project\");\n      const snippets = await loadSnippets(projectDir);\n\n      // Project snippet should override global\n      expect(snippets.get(\"careful\")).toBe(\n        \"Project-specific careful content": "expect(snippets.size).toBe(1);"}, {"review.md": "--", "aliases": "tdd\n  - testing\n---\nProject test guidelines`", "test.md": "--", "project\");\n      const snippets = await loadSnippets(projectDir);\n\n      expect(snippets.size).toBe(5); // review, pr, check, test, tdd, testing\n      expect(snippets.get(\"review\")).toBe(\"Global review guidelines\");\n      expect(snippets.get(\"pr\")).toBe(\"Global review guidelines\");\n      expect(snippets.get(\"check\")).toBe(\"Global review guidelines\");\n      expect(snippets.get(\"test\")).toBe(\"Project test guidelines\");\n      expect(snippets.get(\"tdd\")).toBe(\"Project test guidelines\");\n      expect(snippets.get(\"testing\")).toBe(\"Project test guidelines": ""}, {"careful.md": "--", "aliases": "safe\n  - cautious\n---\nProject careful`", "project\");\n      const snippets = await loadSnippets(projectDir);\n\n      // Project should override with its aliases\n      expect(snippets.get(\"careful\")).toBe(\"Project careful\");\n      expect(snippets.get(\"safe\")).toBe(\"Project careful\");\n      expect(snippets.get(\"cautious\")).toBe(\"Project careful": "expect(snippets.size).toBe(3);"}, {"empty.md\"), \"": "const snippets = await loadSnippets();\n      expect(snippets.size).toBe(1);\n      expect(snippets.get(", "empty\")).toBe(\"": ""}, {"metadata-only.md": "--", "description": "A snippet with only metadata\"\naliases: meta\n---\n`,\n      );\n\n      const snippets = await loadSnippets();\n      expect(snippets.size).toBe(2);\n      expect(snippets.get(\"metadata-only\")).toBe(\"", "expect(snippets.get(\"meta\")).toBe(\"": ""}, {"multiline.md\"),\n        `Line 1\nLine 2\nLine 3`,\n      );\n\n      const snippets = await loadSnippets();\n      expect(snippets.get(\"multiline\")).toBe(\n        \"Line 1\nLine 2\nLine 3": ""}, {"not-a-snippet.txt\"),\n        \"This should be ignored\",\n      );\n      await writeFile(\n        join(globalSnippetDir, \"valid.md\"),\n        \"This should be loaded\",\n      );\n\n      const snippets = await loadSnippets();\n      expect(snippets.size).toBe(1);\n      expect(snippets.get(\"valid\")).toBe(\"This should be loaded\");\n      expect(snippets.has(\"not-a-snippet": ".", "bad-frontmatter.md": "--", "special-chars.md\"),\n        \"Special content\",\n      );\n\n      const snippets = await loadSnippets();\n      expect(snippets.get(\"special-chars\")).toBe(\"Special content": ""}, {"exists": "async () => {\n      // This is a smoke test - just verify it doesn't crash\n      const snippets = await loadSnippets();\n\n      // We don't assert specific content since we don't control the user's global snippets\n      // Just verify it returns a Map\n      expect(snippets).toBeInstanceOf(Map);\n      expect(Array.isArray(snippets.keys())).toBe(true);"}]